<!DOCTYPE html>
<html lang="en"><head>
<script src="6_3b_MLE_discrete_choice_tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="6_3b_MLE_discrete_choice_tutorial_files/libs/quarto-html/tabby.min.js"></script>
<script src="6_3b_MLE_discrete_choice_tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="6_3b_MLE_discrete_choice_tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="6_3b_MLE_discrete_choice_tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="6_3b_MLE_discrete_choice_tutorial_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="6_3b_MLE_discrete_choice_tutorial_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="6_3b_MLE_discrete_choice_tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.433">

  <meta name="author" content="Diego S. Cardoso">
  <title>AGEC 652 - Lecture 6.3, part 2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/dist/theme/quarto.css">
  <link href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">AGEC 652 - Lecture 6.3, part 2</h1>
  <p class="subtitle">Random Utility Models tutorial: estimation and analysis</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Diego S. Cardoso 
</div>
        <p class="quarto-title-affiliation">
            Purdue University
          </p>
    </div>
</div>

</section>
<section id="course-roadmap" class="slide level2" data-background-color="gold">
<h2>Course Roadmap</h2>
<ol type="1">
<li><span class="gray">Introduction to Scientific Computing</span></li>
<li><span class="gray">Fundamentals of numerical methods</span></li>
<li><span class="gray">Systems of equations</span></li>
<li><span class="gray">Optimization</span></li>
<li><span class="gray">Structural estimation: Intro</span></li>
<li><strong>Maximum Likelihood Estimator</strong></li>
<li>Generalized Method of Moments</li>
<li>Simulation-based methods</li>
</ol>
</section>
<section id="main-references-for-today" class="slide level2" data-background-color="gold">
<h2>Main references for today</h2>
<ul>
<li>The examples in this lecture are adapted from “Learning Microeconometrics with R”, by Christopher P. Adams (2021)</li>
<li>Theory: Cameron &amp; Trivedi (2008), Greene (2018)</li>
</ul>
</section>
<section id="introduction" class="slide level2">
<h2>Introduction</h2>
<ul>
<li>In the first part of this tutorial we establish the economic model and generated simulation data from synthetic agents making transportation mode decisions</li>
<li>In this part, we will pretend we don’t know the true parameters of the model and will perform an empirical analysis of the data</li>
<li>We will estimate the parameters and use our estimated model to draw economic insights</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>We can’t learn much about how individuals choose between trains and other transportation modes in cities currently without a rail system</li>
<li>But we also expect that the characteristics of individuals in cities with a rail system might not be exactly the same as those without a system</li>
<li>So our plan is to estimate a choice model based on the “rail cities” and use it to predict the mean behavior of individuals in “non-rail cities”</li>
</ul>
</section>
<section id="empirical-plan" class="slide level2" data-background-color="gold">
<h2>Empirical plan</h2>
<ol type="1">
<li>Estimate a discrete choice model based on the observed choices in rail cities</li>
<li>Use the estimated parameters to predict the mean choices on non-rail cities</li>
<li>Interpret the marginal effects and examine how different characteristics affect the probability of each choice</li>
<li>Estimate the willingness to pay for different modes and characteristics</li>
<li>Estimate the welfare gains/losses from introducing rail systems</li>
</ol>
</section>
<section>
<section id="estimation" class="title-slide slide level1 center">
<h1>1. Estimation</h1>

</section>
<section id="data-load" class="slide level2">
<h2>Data load</h2>
<p>We start by loading the data into memory.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">using</span> <span class="bu">CSV</span>, <span class="bu">DataFrames</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>df <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">"transportation_mode_survey.csv"</span>, DataFrame);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s again inspect the first few rows of this data.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">println</span>(df[<span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, <span class="op">:</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8×10 DataFrame
 Row │ city     price_bus  price_train  stops_bus  stops_train  density  hhsize  homeown  d_ib   d_it  
     │ String7  Float64    Float64      Int64      Int64        Float64  Int64   Int64    Int64  Int64 
─────┼─────────────────────────────────────────────────────────────────────────────────────────────────
   1 │ nr_1          6.49          0.0         36            0     5.3        2        0      1      0
   2 │ nr_2          8.44          0.0         49            0     7.7        2        1      0      0
   3 │ nr_3          5.54          0.0         32            0     4.35       3        1      0      0
   4 │ nr_4          7.99          0.0         44            0     6.29       4        0      0      0
   5 │ nr_5          4.97          0.0         27            0     4.07       2        1      0      0
   6 │ nr_6          3.23          0.0         18            0     2.43       3        1      0      0
   7 │ nr_7          3.72          0.0         17            0     1.87       3        0      0      0
   8 │ nr_8          8.16          0.0         50            0     7.32       3        0      0      0</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Since we want to perform an estimation only on rail cities, we can filter the rows we need from the data frame as follows</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1"></a>df_r <span class="op">=</span> <span class="fu">filter</span>(row <span class="op">-&gt;</span> <span class="fu">startswith</span>(row[<span class="op">:</span>city], <span class="st">"r_"</span>), df);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="defining-beta" class="slide level2">
<h2>Defining <span class="math inline">\(\beta\)</span></h2>
<p>The discrete choice model we will estimate is the Random Utility Model we established in the first part of this tutorial. We will estimate the resulting discrete choice model using MLE.</p>
<p>Let’s then establish the parameter vectors <span class="math inline">\(\beta_b\)</span> and <span class="math inline">\(\beta_t\)</span>. Recall that each separate parameter vectors is a <span class="math inline">\(6 \times 1\)</span> vector indexed as follows</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Covariate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_0\)</span></td>
<td style="text-align: left;">Intercept</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_1\)</span></td>
<td style="text-align: left;"><code>price</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_2\)</span></td>
<td style="text-align: left;"><code>stops</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_3\)</span></td>
<td style="text-align: left;"><code>density</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\beta_4\)</span></td>
<td style="text-align: left;"><code>hhsize</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\beta_5\)</span></td>
<td style="text-align: left;"><code>homeown</code></td>
</tr>
</tbody>
</table>
<p>This way, we can regard the complete parameter vector <span class="math inline">\(\beta\)</span> as staking <span class="math inline">\(\beta_b\)</span> and <span class="math inline">\(\beta_t\)</span>, thus forming a <span class="math inline">\(12 \times 1\)</span> vector.</p>
</section>
<section id="data-preparation" class="slide level2">
<h2>Data preparation</h2>
<p>We will assemble the <span class="math inline">\(X_b\)</span> and <span class="math inline">\(X_t\)</span> matrices so that its columns correspond to each individual parameter in <span class="math inline">\(\beta_b\)</span> and <span class="math inline">\(\beta_t\)</span>.</p>
<p>First, assemble a vector of ones with the same size as the number of observations.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1"></a>N_r <span class="op">=</span> <span class="fu">nrow</span>(df_r);</span>
<span id="cb5-2"><a href="#cb5-2"></a>ones_column <span class="op">=</span> <span class="fu">ones</span>(N_r);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, select the columns for bus and turn that into a matrix <span class="math inline">\(X_b\)</span> and add the column of ones for the intercept.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1"></a>X_b <span class="op">=</span> df_r[<span class="op">:</span>, [<span class="op">:</span>price_bus, <span class="op">:</span>stops_bus, <span class="op">:</span>density, <span class="op">:</span>hhsize, <span class="op">:</span>homeown]]</span>
<span id="cb6-2"><a href="#cb6-2"></a>X_b <span class="op">=</span> <span class="fu">Matrix</span>(X_b) <span class="co"># This converts the DataFrame into a matrix</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>X_b <span class="op">=</span> <span class="fu">hcat</span>(ones_column, X_b); <span class="co"># This concatenates the vector of 1s and X_b horizontally</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Take a peek:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1"></a>X_b[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">:</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>5×6 Matrix{Float64}:
 1.0  6.49  36.0  5.3   3.0  1.0
 1.0  8.44  49.0  7.7   2.0  1.0
 1.0  5.54  32.0  4.35  3.0  1.0
 1.0  7.99  44.0  6.29  3.0  0.0
 1.0  4.97  27.0  4.07  3.0  0.0</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Then, do the same for <span class="math inline">\(X_t\)</span></p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1"></a>X_t <span class="op">=</span> df_r[<span class="op">:</span>, [<span class="op">:</span>price_train, <span class="op">:</span>stops_train, <span class="op">:</span>density, <span class="op">:</span>hhsize, <span class="op">:</span>homeown]]</span>
<span id="cb9-2"><a href="#cb9-2"></a>X_t <span class="op">=</span> <span class="fu">Matrix</span>(X_t)</span>
<span id="cb9-3"><a href="#cb9-3"></a>X_t <span class="op">=</span> <span class="fu">hcat</span>(ones_column, X_t);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Finally, we also want to form our vector of outcomes <span class="math inline">\(d_b\)</span> and <span class="math inline">\(d_t\)</span>.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1"></a>d_b <span class="op">=</span> <span class="fu">Matrix</span>(df_r[<span class="op">:</span>, [<span class="op">:</span>d_ib]]);</span>
<span id="cb10-2"><a href="#cb10-2"></a>d_t <span class="op">=</span> <span class="fu">Matrix</span>(df_r[<span class="op">:</span>, [<span class="op">:</span>d_it]]);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="programming-the-estimator" class="slide level2">
<h2>Programming the estimator</h2>
<p>We are now ready to program our estimator. Recall that the MLE for the Multinomial Logit model is given by</p>
<p><span class="math display">\[
l(\beta) = \sum_{i=1}^N \sum_{k=1}^K d_{ik} \log Pr[y_i = k | X_i] = \sum_{i=1}^N \sum_{k=1}^K d_{ik} (X_{ik}^\prime \beta_k) - \sum_{i=1}^N \log \left(\sum_{k=1}^K e^{X_{ik}^\prime \beta_k}\right)
\]</span></p>
<p>Since <span class="math inline">\(\beta\)</span> is unconstrained, we can use <code>Optim</code> to solve this optimization problem. Therefore, to can program the negative of the <span class="math inline">\(l\)</span> function (remember that <code>Optim</code> solves only minimization problems).</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">function</span> <span class="fu">neg_log_likelihood</span>(β; X_b <span class="op">=</span> X_b, X_t <span class="op">=</span> X_t, d_b <span class="op">=</span> d_b, d_t <span class="op">=</span> d_t)</span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="co"># Unpack separate vector of parameters</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    β_b <span class="op">=</span> β[<span class="fl">1</span><span class="op">:</span><span class="fl">6</span>]</span>
<span id="cb11-4"><a href="#cb11-4"></a>    β_t <span class="op">=</span> β[<span class="fl">7</span><span class="op">:</span><span class="fl">12</span>]</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="co"># Calculate V_ik = X_ik * β_k</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    V_ib <span class="op">=</span> X_b <span class="op">*</span> β_b <span class="co"># Note that his is a matrix multiplication</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>    V_it <span class="op">=</span> X_t <span class="op">*</span> β_t <span class="co"># And this one, too</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="co"># Calculate the denominator of the probabilities (the 2nd term in l)</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    log_denom <span class="op">=</span> <span class="fu">log</span>.(<span class="fl">1.0</span> <span class="op">.+</span> <span class="fu">exp</span>.(V_ib) <span class="op">.+</span> <span class="fu">exp</span>.(V_it))</span>
<span id="cb11-10"><a href="#cb11-10"></a>    <span class="co"># Calculate the whole l</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>    neg_l <span class="op">=</span> <span class="fu">-sum</span>(d_b <span class="op">.*</span> V_ib <span class="op">.+</span> d_t <span class="op">.*</span> V_it <span class="op">.-</span> log_denom)</span>
<span id="cb11-12"><a href="#cb11-12"></a>    <span class="cf">return</span> neg_l</span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="kw">end</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>neg_log_likelihood (generic function with 1 method)</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Let’s try out this function with the vector of true <span class="math inline">\(\beta\)</span></p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1"></a>true_β_b <span class="op">=</span> [<span class="op">-</span><span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.8</span>,  <span class="fl">0.1</span>,  <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.3</span>];</span>
<span id="cb13-2"><a href="#cb13-2"></a>true_β_t <span class="op">=</span> [<span class="op">-</span><span class="fl">0.6</span>, <span class="op">-</span><span class="fl">0.8</span>,  <span class="fl">0.2</span>,  <span class="fl">0.6</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="op">-</span><span class="fl">0.2</span>];</span>
<span id="cb13-3"><a href="#cb13-3"></a>true_β <span class="op">=</span> <span class="fu">vcat</span>(true_β_b, true_β_t);</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="fu">-neg_log_likelihood</span>(true_β)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>-32662.007134423682</code></pre>
</div>
</div>
<p>What if we give it a <span class="math inline">\(\beta = 0\)</span></p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">-neg_log_likelihood</span>(<span class="fu">zeros</span>(<span class="fl">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>-65916.73732008654</code></pre>
</div>
</div>
<p>It has a much smaller value, so definitely not the our MLE estimates!</p>
</section>
<section id="estimating" class="slide level2">
<h2>Estimating</h2>
<p>Next, we can use <code>Optim</code> to solve the optimization for us.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">using</span> <span class="bu">Optim</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="co"># Let's give it a vector of zeros for the initial guess</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>res <span class="op">=</span> <span class="fu">optimize</span>(neg_log_likelihood, <span class="fu">zeros</span>(<span class="fl">12</span>), <span class="fu">BFGS</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code> * Status: success

 * Candidate solution
    Final objective value:     3.212633e+04

 * Found with
    Algorithm:     BFGS

 * Convergence measures
    |x - x'|               = 9.99e-10 ≰ 0.0e+00
    |x - x'|/|x'|          = 7.97e-10 ≰ 0.0e+00
    |f(x) - f(x')|         = 0.00e+00 ≤ 0.0e+00
    |f(x) - f(x')|/|f(x')| = 0.00e+00 ≤ 0.0e+00
    |g(x)|                 = 9.91e-06 ≰ 1.0e-08

 * Work counters
    Seconds run:   5  (vs limit Inf)
    Iterations:    24
    f(x) calls:    115
    ∇f(x) calls:   115</code></pre>
</div>
</div>
<p>Let’s check the minimum value it attains</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1"></a>res.minimum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>32126.33295639354</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>It’s a good practice to check if our optimization is sensitive to the initial guess, so we can be more confident that our estimates are reliable</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1"></a>res_1 <span class="op">=</span> <span class="fu">optimize</span>(neg_log_likelihood, <span class="fu">ones</span>(<span class="fl">12</span>), <span class="fu">BFGS</span>());</span>
<span id="cb21-2"><a href="#cb21-2"></a>res_1.minimum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>32126.33295639354</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1"></a>res_2 <span class="op">=</span> <span class="fu">optimize</span>(neg_log_likelihood, <span class="fl">2</span><span class="fu">*ones</span>(<span class="fl">12</span>), <span class="fu">BFGS</span>());</span>
<span id="cb23-2"><a href="#cb23-2"></a>res_2.minimum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>32126.332956393537</code></pre>
</div>
</div>
<p>OK, these are all pretty close. So let’s stick with the first one for our main estimate.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1"></a>β_MLE <span class="op">=</span> res.minimizer;</span>
<span id="cb25-2"><a href="#cb25-2"></a>β_MLE<span class="ch">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>1×12 adjoint(::Vector{Float64}) with eltype Float64:
 -1.25302  -0.981234  0.109963  0.486675  …  0.744581  -0.13079  -0.215491</code></pre>
</div>
</div>
</section>
<section id="revising-the-estimation" class="slide level2">
<h2>Revising the estimation</h2>
<p>There’s a theoretical problem here, though</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1"></a>β_MLE[<span class="fl">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>-0.9812342431109393</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1"></a>β_MLE[<span class="fl">8</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>-0.9591216015843176</code></pre>
</div>
</div>
<p>We would expect the price coefficients to be the same, because they represent the marginal utility of income. (Later we will need this parameter for welfare analysis). But random noise in the data prevents us from getting exactly the same estimates.</p>
</section>
<section id="revising-the-estimation-1" class="slide level2">
<h2>Revising the estimation</h2>
<p>We can revise our estimation procedure to estimate a restricted model where we will enforce <span class="math inline">\(\beta_{b,1} = \beta_{t,1}\)</span>. To do that, we program an estimator for the restricted model.</p>
<p>In this case, <span class="math inline">\(\beta\)</span> now has only 11 elements, and we will reuse the price coefficient of <span class="math inline">\(\beta_b\)</span> for <span class="math inline">\(\beta_t\)</span>.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">function</span> <span class="fu">restr_neg_log_likelihood</span>(β; X_b <span class="op">=</span> X_b, X_t <span class="op">=</span> X_t, d_b <span class="op">=</span> d_b, d_t <span class="op">=</span> d_t)</span>
<span id="cb31-2"><a href="#cb31-2"></a>    <span class="co"># We just take element 2 in β and insert it again between elements 7 and 8</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>    β_b <span class="op">=</span> β[<span class="fl">1</span><span class="op">:</span><span class="fl">6</span>] <span class="co"># The usual</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>    β_t <span class="op">=</span> <span class="fu">vcat</span>(β[<span class="fl">7</span>], β[<span class="fl">2</span>], β[<span class="fl">8</span><span class="op">:</span><span class="fl">11</span>]) <span class="co"># Repeat the price coefficient</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>    <span class="co"># Stack it again</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>    β_restricted <span class="op">=</span> <span class="fu">vcat</span>(β_b, β_t) </span>
<span id="cb31-7"><a href="#cb31-7"></a>    <span class="co"># The rest is like the previous one, so we can just call our other function!</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>    neg_l <span class="op">=</span> <span class="fu">neg_log_likelihood</span>(β_restricted; X_b <span class="op">=</span> X_b, X_t <span class="op">=</span> X_t, d_b <span class="op">=</span> d_b, d_t <span class="op">=</span> d_t)</span>
<span id="cb31-9"><a href="#cb31-9"></a>    <span class="cf">return</span> neg_l</span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="kw">end</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>restr_neg_log_likelihood (generic function with 1 method)</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Run the optimization/estimation!</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1"></a>res_restr <span class="op">=</span> <span class="fu">optimize</span>(restr_neg_log_likelihood, <span class="fu">zeros</span>(<span class="fl">11</span>), <span class="fu">BFGS</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code> * Status: success

 * Candidate solution
    Final objective value:     3.212641e+04

 * Found with
    Algorithm:     BFGS

 * Convergence measures
    |x - x'|               = 0.00e+00 ≤ 0.0e+00
    |x - x'|/|x'|          = 0.00e+00 ≤ 0.0e+00
    |f(x) - f(x')|         = 0.00e+00 ≤ 0.0e+00
    |f(x) - f(x')|/|f(x')| = 0.00e+00 ≤ 0.0e+00
    |g(x)|                 = 1.20e-06 ≰ 1.0e-08

 * Work counters
    Seconds run:   6  (vs limit Inf)
    Iterations:    35
    f(x) calls:    136
    ∇f(x) calls:   136</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1"></a>β_MLE_restr <span class="op">=</span> res_restr.minimizer;</span>
<span id="cb35-2"><a href="#cb35-2"></a>β_MLE_restr<span class="ch">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>1×11 adjoint(::Vector{Float64}) with eltype Float64:
 -1.26834  -0.962045  0.10644  0.49067  …  0.744867  -0.130826  -0.215556</code></pre>
</div>
</div>
</section>
<section id="testing-the-restriction" class="slide level2">
<h2>Testing the restriction</h2>
<p>Is this restriction empirically sensible? We know how to test it! We can use the LR test, for example, with a null hypothesis that <span class="math inline">\(\beta_{b,1} = \beta_{t,1}\)</span>. Recall</p>
<p><span class="math display">\[
LR = 2 \left(l(\hat{\beta}_U) - l(\hat{\beta}_R) \right) \sim \chi^2_{1}
\]</span></p>
<p>Luckily, we already have the value of the objective function for each of those cases stored for us the optimization results, so this test statistic is easy to calculate!</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1"></a>l_U <span class="op">=</span> <span class="op">-</span>res.minimum;</span>
<span id="cb37-2"><a href="#cb37-2"></a>l_R <span class="op">=</span> <span class="op">-</span>res_restr.minimum;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1"></a>LR_stat <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> (l_U <span class="op">-</span> l_R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0.15121039505902445</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>It’s also easy calculate the critical value for this test using the quantile of the <span class="math inline">\(\chi^2_{1}\)</span> distribution with <span class="math inline">\(\alpha = 0.05\)</span></p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>crit_value <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">Chisq</span>(<span class="fl">1</span>), <span class="fl">0.95</span>);</span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="fu">println</span>(<span class="st">"Critical value: </span><span class="sc">$</span>crit_value<span class="st"> . Test statistic: </span><span class="sc">$</span>LR_stat<span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Critical value: 3.8414588206941245 . Test statistic: 0.15121039505902445</code></pre>
</div>
</div>
<p>Thus, we cannot reject the null hypothesis. We will stick with the restricted estimate as our main estimate now.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1"></a>β_b_hat <span class="op">=</span> β_MLE_restr[<span class="fl">1</span><span class="op">:</span><span class="fl">6</span>]; <span class="co"># The usual</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>β_t_hat <span class="op">=</span> <span class="fu">vcat</span>(β_MLE_restr[<span class="fl">7</span>], β_MLE_restr[<span class="fl">2</span>], β_MLE_restr[<span class="fl">8</span><span class="op">:</span><span class="fl">11</span>]); <span class="co"># Repeat the price coefficient</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>β_hat <span class="op">=</span> <span class="fu">vcat</span>(β_b_hat, β_t_hat);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bias" class="slide level2">
<h2>Bias?</h2>
<p>Let’s now compare our estimates with the true values.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1"></a>true_β<span class="op">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>1×12 adjoint(::Vector{Float64}) with eltype Float64:
 -1.0  -0.8  0.1  0.3  -0.2  -0.3  -0.6  -0.8  0.2  0.6  -0.1  -0.2</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1"></a>β_hat<span class="ch">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>1×12 adjoint(::Vector{Float64}) with eltype Float64:
 -1.26834  -0.962045  0.10644  0.49067  …  0.744867  -0.130826  -0.215556</code></pre>
</div>
</div>
<p>Looks like we got a significant bias here… All coefficients are larger in absolute value! Is this some kind of bias?</p>
</section>
<section class="slide level2">

<p>Nope! Remember, <span class="math inline">\(\beta\)</span> is not identified! We can only estimate <span class="math inline">\(\beta/\sigma\)</span>, but in the MLE estimation, we assumed <span class="math inline">\(\sigma = 1\)</span>.</p>
<p>We know that the true value of <span class="math inline">\(\sigma\)</span> was <span class="math inline">\(0.8\)</span>. Let’s compare our estimates with the true <span class="math inline">\(\beta/\sigma\)</span>.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1"></a>true_β<span class="op">'./</span><span class="fl">0.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>1×12 Matrix{Float64}:
 -1.25  -1.0  0.125  0.375  -0.25  -0.375  …  -1.0  0.25  0.75  -0.125  -0.25</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1"></a>β_hat<span class="ch">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>1×12 adjoint(::Vector{Float64}) with eltype Float64:
 -1.26834  -0.962045  0.10644  0.49067  …  0.744867  -0.130826  -0.215556</code></pre>
</div>
</div>
<p>Not perfect, but they align a lot closer now.</p>
</section>
<section id="calculating-standard-errors" class="slide level2">
<h2>Calculating standard errors</h2>
<p>We know how to calculate asymptotic standard errors for the MLE using numerical differentiation.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1"></a><span class="im">using</span> <span class="bu">ForwardDiff</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>Im <span class="op">=</span> <span class="op">-</span>ForwardDiff.<span class="fu">hessian</span>(restr_neg_log_likelihood, β_MLE_restr) <span class="co"># Flip the signs</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>V <span class="op">=</span> <span class="fu">inv</span>(Im);</span>
<span id="cb51-4"><a href="#cb51-4"></a>SEs <span class="op">=</span> <span class="fu">sqrt</span>.(<span class="fu">diag</span>(<span class="op">-</span>V));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>And we can organize our results in a classic estimates table</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb52-1"><a href="#cb52-1"></a>res_df <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb52-2"><a href="#cb52-2"></a>  Coefficient <span class="op">=</span> [<span class="st">"β_b0"</span>, <span class="st">"β_b1=β_t1"</span>, <span class="st">"β_b2"</span>, <span class="st">"β_b3"</span>, <span class="st">"β_b4"</span>, <span class="st">"β_b5"</span>, <span class="st">"β_t0"</span>, <span class="st">"β_t2"</span>, <span class="st">"β_t3"</span>, <span class="st">"β_t4"</span>, <span class="st">"β_t5"</span>],</span>
<span id="cb52-3"><a href="#cb52-3"></a>  Estimate <span class="op">=</span> β_MLE_restr,</span>
<span id="cb52-4"><a href="#cb52-4"></a>  StdError <span class="op">=</span> SEs,</span>
<span id="cb52-5"><a href="#cb52-5"></a>  CI_lower <span class="op">=</span> β_MLE_restr <span class="op">.+</span> <span class="fu">quantile</span>(<span class="fu">Normal</span>(), <span class="fl">0.025</span>) <span class="op">.*</span> SEs,</span>
<span id="cb52-6"><a href="#cb52-6"></a>  CI_upper <span class="op">=</span> β_MLE_restr <span class="op">.+</span> <span class="fu">quantile</span>(<span class="fu">Normal</span>(), <span class="fl">0.975</span>) <span class="op">.*</span> SEs</span>
<span id="cb52-7"><a href="#cb52-7"></a>)</span>
<span id="cb52-8"><a href="#cb52-8"></a><span class="fu">println</span>(res_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>11×5 DataFrame
 Row │ Coefficient  Estimate   StdError    CI_lower    CI_upper  
     │ String       Float64    Float64     Float64     Float64   
─────┼───────────────────────────────────────────────────────────
   1 │ β_b0         -1.26834   0.0649339   -1.3956     -1.14107
   2 │ β_b1=β_t1    -0.962045  0.01838     -0.998069   -0.926021
   3 │ β_b2          0.10644   0.00857776   0.0896282   0.123252
   4 │ β_b3          0.49067   0.0473282    0.397908    0.583432
   5 │ β_b4         -0.256119  0.012644    -0.280901   -0.231337
   6 │ β_b5         -0.385548  0.0284063   -0.441223   -0.329873
   7 │ β_t0         -0.741272  0.0818007   -0.901598   -0.580946
   8 │ β_t2          0.236894  0.00857381   0.22009     0.253698
   9 │ β_t3          0.744867  0.0096659    0.725923    0.763812
  10 │ β_t4         -0.130826  0.0125632   -0.15545    -0.106203
  11 │ β_t5         -0.215556  0.0301444   -0.274638   -0.156474</code></pre>
</div>
</div>
</section>
<section id="empirical-plan-1" class="slide level2" data-background-color="gold">
<h2>Empirical plan</h2>
<ol type="1">
<li><span class="gray">Estimate a discrete choice model based on the observed choices in rail cities</span></li>
<li><strong>Use the estimated parameters to predict the mean choices on non-rail cities</strong></li>
<li>Interpret the marginal effects and examine how different characteristics affect the probability of each choice</li>
<li>Estimate the willingness to pay for different modes and characteristics</li>
<li>Estimate the welfare gains/losses from introducing rail systems</li>
</ol>
</section></section>
<section>
<section id="prediction" class="title-slide slide level1 center">
<h1>2. Prediction</h1>

</section>
<section id="sanity-check" class="slide level2">
<h2>Sanity check</h2>
<p>Before thinking about the non-rail cities, let’s assess how good our model is predicting the mean choices in the same sample we used to estimate the model.</p>
<p>That’s easy to do: just apply the parameters to the same <span class="math inline">\(X_b\)</span> and <span class="math inline">\(X_t\)</span>. Recall</p>
<p><span class="math display">\[
Pr[y_i = k | X_i] = \frac{e^{X_{ik}^\prime \beta_k}}{\sum_{j=1}^J e^{X_{ij}^\prime \beta_j}} = \frac{e^{V_{ik}}}{\sum_{j=1}^J e^{V_{ij}}}
\]</span></p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Predictions</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>V_b_hat <span class="op">=</span> X_b <span class="op">*</span> β_hat[<span class="fl">1</span><span class="op">:</span><span class="fl">6</span>];</span>
<span id="cb54-3"><a href="#cb54-3"></a>V_t_hat <span class="op">=</span> X_t <span class="op">*</span> β_hat[<span class="fl">7</span><span class="op">:</span><span class="fl">12</span>];</span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="co"># The denominator is the same for all options</span></span>
<span id="cb54-5"><a href="#cb54-5"></a>denom_r <span class="op">=</span> <span class="fl">1.0</span> <span class="op">.+</span> <span class="fu">exp</span>.(V_b_hat) <span class="op">.+</span> <span class="fu">exp</span>.(V_t_hat);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Calculating the probabilities for each observation</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1"></a>prob_b_r <span class="op">=</span> <span class="fu">exp</span>.(V_b_hat) <span class="op">./</span> denom_r;</span>
<span id="cb55-2"><a href="#cb55-2"></a>prob_t_r <span class="op">=</span> <span class="fu">exp</span>.(V_t_hat) <span class="op">./</span> denom_r;</span>
<span id="cb55-3"><a href="#cb55-3"></a>prob_c_r <span class="op">=</span> <span class="fl">1.0</span> <span class="op">.-</span> prob_b_r <span class="op">.-</span> prob_t_r;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So the predicted mean (or expected) probability of chosing the bus is</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb56-1"><a href="#cb56-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>mean_prob_b_r <span class="op">=</span> <span class="fu">mean</span>(prob_b_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.09985000000032383</code></pre>
</div>
</div>
<p>How does this compare to the observed share of bus riders?</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">sum</span>(d_b)<span class="op">/</span>N_r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>0.09985</code></pre>
</div>
</div>
<p>Pretty good prediction!</p>
</section>
<section class="slide level2">

<p>How about for the train?</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb60-1"><a href="#cb60-1"></a>mean_prob_t_r <span class="op">=</span> <span class="fu">mean</span>(prob_t_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>0.13886666666597253</code></pre>
</div>
</div>
<p>How does this compare to the observed share of bus riders?</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb62-1"><a href="#cb62-1"></a><span class="fu">sum</span>(d_t)<span class="op">/</span>N_r</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0.13886666666666667</code></pre>
</div>
</div>
<p>Also spot on!</p>
</section>
<section id="predicting-for-non-rail-cities" class="slide level2">
<h2>Predicting for non-rail cities</h2>
<p>This sanity check helped us see how we can perform the same exercise, but now using the <span class="math inline">\(X\)</span> matrices for non-rail cities.</p>
<p>We can assemble those matrices the same way we did for rail cities.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Filter for nr cities</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>df_nr <span class="op">=</span> <span class="fu">filter</span>(row <span class="op">-&gt;</span> <span class="fu">startswith</span>(row[<span class="op">:</span>city], <span class="st">"nr_"</span>), df);</span>
<span id="cb64-3"><a href="#cb64-3"></a>N_nr <span class="op">=</span> <span class="fu">nrow</span>(df_nr);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assemble <span class="math inline">\(X_b\)</span> for non-rail</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb65-1"><a href="#cb65-1"></a><span class="co"># Here we are combining a few steps at once</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>X_b_nr <span class="op">=</span> <span class="fu">Matrix</span>(df_nr[<span class="op">:</span>, [<span class="op">:</span>price_bus, <span class="op">:</span>stops_bus, <span class="op">:</span>density, <span class="op">:</span>hhsize, <span class="op">:</span>homeown]]);</span>
<span id="cb65-3"><a href="#cb65-3"></a>X_b_nr <span class="op">=</span> <span class="fu">hcat</span>(<span class="fu">ones</span>(<span class="fu">nrow</span>(df_nr)), X_b_nr);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Next, we need to assemble <span class="math inline">\(X_t\)</span>. However, we must make a choice: these cities don’t have rail prices or number of stops… For what kind of rail system do we want to predict?</p>
<p>One option is to predict for a system that</p>
<ul>
<li>Has a price that is 10% higher than the currently observed bus prices</li>
<li>Has exactly 10 train stops (so an initially small network)</li>
</ul>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb66-1"><a href="#cb66-1"></a>X_t_nr <span class="op">=</span> df_nr[<span class="op">:</span>, [<span class="op">:</span>price_bus, <span class="op">:</span>stops_train, <span class="op">:</span>density, <span class="op">:</span>hhsize, <span class="op">:</span>homeown]];</span>
<span id="cb66-2"><a href="#cb66-2"></a>X_t_nr.price_bus <span class="op">=</span> <span class="fl">1.1</span> <span class="op">.*</span> X_t_nr.price_bus; <span class="co"># 5% more expensive</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>X_t_nr.stops_train <span class="op">=</span> <span class="fl">10</span> <span class="op">.*</span> <span class="fu">ones</span>(N_nr); <span class="co"># 10 stops</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>X_t_nr <span class="op">=</span> <span class="fu">Matrix</span>(X_t_nr);</span>
<span id="cb66-5"><a href="#cb66-5"></a>X_t_nr <span class="op">=</span> <span class="fu">hcat</span>(<span class="fu">ones</span>(N_nr), X_t_nr);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>We can proceed with the calculation of probabilities like in the rail case.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Predictions</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>V_b_hat_nr <span class="op">=</span> X_b_nr <span class="op">*</span> β_hat[<span class="fl">1</span><span class="op">:</span><span class="fl">6</span>];</span>
<span id="cb67-3"><a href="#cb67-3"></a>V_t_hat_nr <span class="op">=</span> X_t_nr <span class="op">*</span> β_hat[<span class="fl">7</span><span class="op">:</span><span class="fl">12</span>];</span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="co"># The denominator is the same for all options</span></span>
<span id="cb67-5"><a href="#cb67-5"></a>denom_nr <span class="op">=</span> <span class="fl">1.0</span> <span class="op">.+</span> <span class="fu">exp</span>.(V_b_hat_nr) <span class="op">.+</span> <span class="fu">exp</span>.(V_t_hat_nr);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1"></a>prob_b_nr <span class="op">=</span> <span class="fu">exp</span>.(V_b_hat_nr) <span class="op">./</span> denom_nr;</span>
<span id="cb68-2"><a href="#cb68-2"></a>prob_t_nr <span class="op">=</span> <span class="fu">exp</span>.(V_t_hat_nr) <span class="op">./</span> denom_nr;</span>
<span id="cb68-3"><a href="#cb68-3"></a>prob_c_nr <span class="op">=</span> <span class="fl">1.0</span> <span class="op">.-</span> prob_b_nr <span class="op">.-</span> prob_t_nr;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>Finally, we calculate the predicted mean (expected) probabilities of each choice</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1"></a>mean_prob_b_nr <span class="op">=</span> <span class="fu">mean</span>(prob_b_nr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0.09041621616633082</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb71-1"><a href="#cb71-1"></a>mean_prob_t_nr <span class="op">=</span> <span class="fu">mean</span>(prob_t_nr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>0.14923985762722458</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1"></a>mean_prob_c_nr <span class="op">=</span> <span class="fu">mean</span>(prob_c_nr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>0.7603439262064445</code></pre>
</div>
</div>
<p>So, about 9% for bus, 15% for train, and 76% for cars!</p>
<p>As in the BART case, the predicted train ridership is below that of the survey. But, of course, we could play with different train prices and stops to have different predicted probabilities.</p>
</section>
<section id="empirical-plan-2" class="slide level2" data-background-color="gold">
<h2>Empirical plan</h2>
<ol type="1">
<li><span class="gray">Estimate a discrete choice model based on the observed choices in rail cities</span></li>
<li><span class="gray">Use the estimated parameters to predict the mean choices on non-rail cities</span></li>
<li><strong>Interpret the marginal effects and examine how different characteristics affect the probability of each choice</strong></li>
<li>Estimate the willingness to pay for different modes and characteristics</li>
<li>Estimate the welfare gains/losses from introducing rail systems</li>
</ol>
</section></section>
<section>
<section id="interpretation" class="title-slide slide level1 center">
<h1>3. Interpretation</h1>

</section>
<section id="the-problem-with-raw-beta" class="slide level2">
<h2>The problem with raw <span class="math inline">\(\beta\)</span></h2>
<p>The raw <span class="math inline">\(\beta\)</span> coefficients in non-linear discrete choice models are hard to interpret.</p>
<ul>
<li>First, because these coefficients map observed characteristics to the latent variable, which is not very intuitive.</li>
<li>Second, because the <span class="math inline">\(\beta\)</span> themselves are divided by some non-identifiable <span class="math inline">\(\sigma\)</span>, so their absolute value has little meaning.</li>
<li>Third, because unlike linear regressions, the marginal effect of some variable change in <span class="math inline">\(x_j\)</span> on <span class="math inline">\(Y\)</span> is not just <span class="math inline">\(\beta_j\)</span>.</li>
</ul>
<p>For these reasons, we typically opt to interpret the calculate marginal effects implied by our estimates.</p>
</section>
<section id="marginal-effects" class="slide level2">
<h2>Marginal effects</h2>
<p>In the context of a discrete choice model, the marginal effect of a continuous covariate <span class="math inline">\(x_a\)</span> is given by</p>
<p><span class="math display">\[
\frac{\partial \Pr[Y = k | X]}{\partial x_a}
\]</span></p>
<p>But what <span class="math inline">\(X\)</span> do we choose? In linear models, it doesn’t really matter because the marginal effect is determined by linear parameters, so <span class="math display">\[
E\left[\frac{\partial E[Y|X]}{\partial x_a}\right] = \frac{\partial E[Y|E[X]]}{\partial x_a} = \beta_a
\]</span></p>
<p>But in nonlinear models, that equality does not hold!</p>
</section>
<section class="slide level2">

<p>Here, we have two options:</p>
<ol type="1">
<li>Calculate the mean marginal effect: <span class="math inline">\(E\left[\frac{\partial \Pr[Y = k | X]}{\partial x_a}\right]\)</span></li>
<li>Calculate mean marginal effect on the mean: <span class="math inline">\(\frac{\partial \Pr[Y = k | E[X]]}{\partial x_a}\)</span></li>
</ol>
<p>While there is no single right approach, option 1 is typically preferred because</p>
<ul>
<li>It averages out across your sample, so it’s refletive of your observations.</li>
<li>Sometimes an “average individual” (i.e., one with all characteristics at the sample average) is implausible or not an interesting case.</li>
</ul>
</section>
<section id="marginal-effects-in-multinomial-logit" class="slide level2">
<h2>Marginal effects in multinomial logit</h2>
<p>For the multinomial logit case, we have a closed-form expression of the marginal effect.</p>
<p>For a simpler notation, let <span class="math inline">\(p_{ik} = \Pr[Y_i = k | X_i]\)</span>. Then, the marginal effect on choice <span class="math inline">\(k\)</span> for a change in the vector of characteristics of choice <span class="math inline">\(j\)</span> is given by</p>
<p><span class="math display">\[
\frac{\partial p_{ik}}{\partial X_{ij}} =  p_{ik}(\delta_{ikj} - p_{ij})\beta
\]</span></p>
<p>where <span class="math inline">\(\delta_{ijk} = 1\)</span> if <span class="math inline">\(j=k\)</span> (“own” marginal effect) or <span class="math inline">\(0\)</span> otherwise (“cross” marginal effect).</p>
</section>
<section class="slide level2">

<p>For example, the marginal effect of the number of train stops (mapped to <span class="math inline">\(\beta_{t,2}\)</span>) on the probability of choosing train is given by</p>
<p><span class="math display">\[
\frac{\partial p_{it}}{\partial x_{it,2}} =  p_{it}(1 - p_{it})\beta_{t,2}
\]</span></p>
<p>Similarly, the marginal effect of the same variable on the probability of choosing bus is</p>
<p><span class="math display">\[
\frac{\partial p_{ib}}{\partial x_{it,2}} =  p_{ib}(0 - p_{it})\beta_{t,2} = -p_{ib}p_{it}\beta_{t,2}
\]</span></p>
<p>Let’s use these formulas to calculate the mean marginal effect of train prices and the number of stops.</p>
</section>
<section id="calculating-marginal-effects" class="slide level2">
<h2>Calculating marginal effects</h2>
<p>Let’s use these formulas to calculate the average marginal effect of train stops.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb75-1"><a href="#cb75-1"></a>mg_effect_t_trainstops <span class="op">=</span> prob_t_nr <span class="op">.*</span> (<span class="fl">1.0</span> <span class="op">.-</span> prob_t_nr) <span class="op">.*</span> β_t_hat[<span class="fl">3</span>]; <span class="co"># Index 3 because we start from zero</span></span>
<span id="cb75-2"><a href="#cb75-2"></a>mg_effect_b_trainstops <span class="op">=</span> <span class="op">-</span>prob_b_nr <span class="op">.*</span> prob_t_nr <span class="op">.*</span> β_t_hat[<span class="fl">3</span>];</span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="fu">println</span>(<span class="st">"AME of train stops on prob. of train: </span><span class="sc">$</span>(<span class="fu">mean</span>(mg_effect_t_trainstops))<span class="st">.</span><span class="sc">\n</span><span class="st"> And on prob. of bus: </span><span class="sc">$</span>(<span class="fu">mean</span>(mg_effect_b_trainstops))<span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AME of train stops on prob. of train: 0.028873530257323067.
 And on prob. of bus: -0.002914283110489992</code></pre>
</div>
</div>
<p>So, raising the number of stops from 10 to 11 would increase the share of train riders by about 2.8 percentage points (pp)! It would also reduce the number of bus riders by about 0.29 pp, so little substitution would happen.</p>
</section>
<section class="slide level2">

<p>We can do a similar exercise with the marginal effect of train prices.</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb77-1"><a href="#cb77-1"></a>mg_effect_t_trainprice <span class="op">=</span> prob_t_nr <span class="op">.*</span> (<span class="fl">1.0</span> <span class="op">.-</span> prob_t_nr) <span class="op">.*</span> β_t_hat[<span class="fl">2</span>]; <span class="co"># Index 2 because we start from zero</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>mg_effect_b_trainprice <span class="op">=</span> <span class="op">-</span>prob_b_nr <span class="op">.*</span> prob_t_nr <span class="op">.*</span> β_t_hat[<span class="fl">2</span>];</span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="fu">println</span>(<span class="st">"AME of train prices on prob. of train: </span><span class="sc">$</span>(<span class="fu">mean</span>(mg_effect_t_trainprice))<span class="st">.</span><span class="sc">\n</span><span class="st"> And on prob. of bus: </span><span class="sc">$</span>(<span class="fu">mean</span>(mg_effect_b_trainprice))<span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AME of train prices on prob. of train: -0.1172576271964368.
 And on prob. of bus: 0.011835127865185044</code></pre>
</div>
</div>
<p>So, increasing the price of trains by 1 (hundred dollars), would drop it’s ridership by a lot and increase bus ridership by about 1 pp.</p>
</section>
<section class="slide level2">

<p>Since we are dealing with marginal effects of price on demand, it’s easy to calculate elasticities, too!</p>
<ul>
<li>Recall that the price elasticity of demand is defined as <span class="math inline">\(\frac{\partial Q}{\partial P} \frac{P}{Q}\)</span></li>
<li>Also, in expectation, the probability of a choice represents the market share of that choice.
<ul>
<li>In other words, the expected number of riders of trains among the N surveyed individuals is <span class="math inline">\(E[Q] = N \times \Pr[y = t]\)</span></li>
<li>But the expected market share is <span class="math inline">\(E[Q]/N = \Pr[y = t]\)</span></li>
</ul></li>
</ul>
<p>Therefore,</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb79-1"><a href="#cb79-1"></a>trainprices <span class="op">=</span> X_t_nr[<span class="op">:</span>,<span class="fl">2</span>] <span class="co"># Second column in X_t </span></span>
<span id="cb79-2"><a href="#cb79-2"></a>elast_t_trainprice <span class="op">=</span>  (<span class="fl">1.0</span> <span class="op">.-</span> prob_t_nr) <span class="op">.*</span> β_t_hat[<span class="fl">2</span>] <span class="op">.*</span> trainprices; <span class="co"># Since we divide by q, own probability drops out</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>elast_b_trainprice <span class="op">=</span> <span class="op">-</span>prob_t_nr <span class="op">.*</span> β_t_hat[<span class="fl">2</span>] <span class="op">.*</span> trainprices;</span>
<span id="cb79-4"><a href="#cb79-4"></a><span class="fu">println</span>(<span class="st">"The mean elasticity of train demand w.r.t. train prices is: </span><span class="sc">$</span>(<span class="fu">mean</span>(elast_t_trainprice))<span class="st">.</span><span class="sc">\n</span><span class="st"> And for bus demand w.r.t. train prices is: </span><span class="sc">$</span>(<span class="fu">mean</span>(elast_b_trainprice))<span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The mean elasticity of train demand w.r.t. train prices is: -5.224014778997108.
 And for bus demand w.r.t. train prices is: 0.7967204616977237</code></pre>
</div>
</div>
<p>That’s a pretty high own price elasticity in absolute terms. (Probably too high to be realistic…)</p>
</section>
<section id="empirical-plan-3" class="slide level2" data-background-color="gold">
<h2>Empirical plan</h2>
<ol type="1">
<li><span class="gray">Estimate a discrete choice model based on the observed choices in rail cities</span></li>
<li><span class="gray">Use the estimated parameters to predict the mean choices on non-rail cities</span></li>
<li><span class="gray">Interpret the marginal effects and examine how different characteristics affect the probability of each choice</span></li>
<li><strong>Estimate the willingness to pay for different modes and characteristics</strong></li>
<li>Estimate the welfare gains/losses from introducing rail systems</li>
</ol>
</section></section>
<section>
<section id="willingness-to-pay" class="title-slide slide level1 center">
<h1>4. Willingness to pay</h1>

</section>
<section id="empirical-plan-4" class="slide level2" data-background-color="gold">
<h2>Empirical plan</h2>
<ol type="1">
<li><span class="gray">Estimate a discrete choice model based on the observed choices in rail cities</span></li>
<li><span class="gray">Use the estimated parameters to predict the mean choices on non-rail cities</span></li>
<li><span class="gray">Interpret the marginal effects and examine how different characteristics affect the probability of each choice</span></li>
<li><span class="gray">Estimate the willingness to pay for different modes and characteristics</span></li>
<li><strong>Estimate the welfare gains/losses from introducing rail systems</strong></li>
</ol>
</section></section>
<section id="welfare-consequences" class="title-slide slide level1 center">
<h1>5. Welfare consequences</h1>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="6_3b_MLE_discrete_choice_tutorial_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"theme":"whiteboard","chalkEffect":0.1},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>